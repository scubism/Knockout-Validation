/// <reference path="../Lib/knockout-latest.debug.js" />
/*
*   Knockout Validation
*   Created By Eric M. Barnard (https://github.com/ericmbarnard)
*
*   Source: https://github.com/ericmbarnard/Knockout-Validation
*   MIT License: http://www.opensource.org/licenses/MIT
*/(function(){function i(e,t,n){if(!t.validator(e(),n.params===undefined?!0:n.params)){e.error=ko.validation.formatMessage(n.message||t.message,n.params);e.__valid__(!1);return!1}return!0}function s(e,t,n){e.isValidating(!0);var r=function(r){var i=!1,s="";if(!e.__valid__())return;if(r.message){i=r.isValid;s=r.message}else i=r;if(i)return;e.error=ko.validation.formatMessage(s||n.message||t.message,n.params);e.isValidating(!1);e.__valid__(i)};t.validator(e(),n.params||!0,r)}if(typeof ko===undefined)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";var e={registerExtenders:!0,messagesOnModified:!0,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,decorateElement:!1,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",grouping:{deep:!1,observable:!0}},t=["required","pattern","min","max","step"],n=function(e){window.setImmediate?window.setImmediate(e):window.setTimeout(e,0)},r=function(){var t=(new Date).getTime(),n={},i="__ko_validation__";return{isArray:function(e){return e.isArray||Object.prototype.toString.call(e)==="[object Array]"},isObject:function(e){return e!==null&&typeof e=="object"},values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},getValue:function(e){return typeof e=="function"?e():e},hasAttribute:function(e,t){return e.getAttribute(t)!==null&&e.getAttribute(t)!==undefined&&e.getAttribute(t)!==""},isValidatable:function(e){return e.rules&&e.isValid&&e.isModified},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},newId:function(){return t+=1},getConfigOptions:function(t){var n=r.contextFor(t);return n||e},setDomData:function(e,t){var s=e[i];s||(e[i]=s=r.newId());n[s]=t},getDomData:function(e){var t=e[i];return t?n[t]:undefined},contextFor:function(e){switch(e.nodeType){case 1:case 8:var t=r.getDomData(e);if(t)return t;if(e.parentNode)return r.contextFor(e.parentNode)}return undefined},isEmptyVal:function(e){if(e===undefined)return!0;if(e===null)return!0;if(e==="")return!0}}}();ko.validation=function(){var n=0;return{utils:r,init:function(t,r){if(n>0&&!r)return;t=t||{};t.errorElementClass=t.errorElementClass||t.errorClass||e.errorElementClass;t.errorMessageClass=t.errorMessageClass||t.errorClass||e.errorMessageClass;ko.utils.extend(e,t);e.registerExtenders&&ko.validation.registerExtenders();n=1},configure:function(e){ko.validation.init(e)},validate:function(e){var t=[];validatables=ko.observableArray([]);traverse=function n(e,t){val=ko.utils.unwrapObservable(e);ko.isObservable(e)&&e.isValid&&validatables.push(e);val&&(r.isArray(val)?objValues=val:r.isObject(val)&&(objValues=r.values(val)));t!==0&&ko.utils.arrayForEach(objValues,function(e){e&&!e.nodeType&&n(e,t+1)})};traverse(e,-1);ko.utils.arrayForEach(validatables(),function(e){var n=e.validate();n||t.push(e)});return t},group:function(n,i){var i=ko.utils.extend(e.grouping,i),s=ko.observableArray([]),o=null,u=function a(e,t){var n=[],o=ko.utils.unwrapObservable(e);t=t!==undefined?t:i.deep?1:-1;if(ko.isObservable(e)){e.isValid||e.extend({validatable:!0});s.push(e)}o&&(r.isArray(o)?n=o:r.isObject(o)&&(n=r.values(o)));t!==0&&ko.utils.arrayForEach(n,function(e){e&&!e.nodeType&&a(e,t+1)})};if(i.observable){u(n);o=ko.computed(function(){var e=[];ko.utils.arrayForEach(s(),function(t){t.isValid()||e.push(t.error)});return e})}else o=function(){var e=[];s([]);u(n);ko.utils.arrayForEach(s(),function(t){t.isValid()||e.push(t.error)});return e};o.showAllMessages=function(e){e==undefined&&(e=!0);o();ko.utils.arrayForEach(s(),function(t){t.isModified(e)})};n.errors=o;n.isValid=function(){return n.errors().length===0};return o},formatMessage:function(e,t){return e.replace(/\{0\}/gi,t)},addRule:function(e,t){try{e.extend({validatable:!0});e.rules.push(t)}catch(n){}return e},addAnonymousRule:function(e,t){var n=r.newId();ko.validation.rules[n]={validator:t.validator,message:t.message||"Error"};ko.validation.addRule(e,{rule:n,params:t.params})},addExtender:function(e){ko.extenders[e]=function(t,n){return n.message?ko.validation.addRule(t,{rule:e,message:n.message,params:n.params||!0}):ko.validation.addRule(t,{rule:e,params:n})}},registerExtenders:function(){if(e.registerExtenders)for(var t in ko.validation.rules)ko.validation.rules.hasOwnProperty(t)&&(ko.extenders[t]||ko.validation.addExtender(t))},insertValidationMessage:function(t){var n=document.createElement("SPAN");n.className=e.errorMessageClass;r.insertAfter(t,n);return n},parseInputValidationAttributes:function(e,n){ko.utils.arrayForEach(t,function(t){if(r.hasAttribute(e,t)){val=e.getAttribute(t);ko.validation.addRule(n(),{rule:t,params:e.getAttribute(t)||!0})}})}}}();ko.validation.rules={};ko.validation.rules.required={validator:function(e,t){var n=/^\s+|\s+$/g,r;if(!t)return!0;if(e===undefined||e===null)return!t;r=e;typeof e=="string"&&(r=e.replace(n,""));return t&&(r+"").length>0},message:"This field is required."};ko.validation.rules.min={validator:function(e,t){return r.isEmptyVal(e)||e>=t},message:"Please enter a value greater than or equal to {0}."};ko.validation.rules.max={validator:function(e,t){return r.isEmptyVal(e)||e<=t},message:"Please enter a value less than or equal to {0}."};ko.validation.rules.minLength={validator:function(e,t){return r.isEmptyVal(e)||e.length>=t},message:"Please enter at least {0} characters."};ko.validation.rules.maxLength={validator:function(e,t){return r.isEmptyVal(e)||e.length<=t},message:"Please enter no more than {0} characters."};ko.validation.rules.pattern={validator:function(e,t){return r.isEmptyVal(e)||e.match(t)!=null},message:"Please check this value."};ko.validation.rules.step={validator:function(e,t){return r.isEmptyVal(e)||e%t===0},message:"The value must increment by {0}"};ko.validation.rules.email={validator:function(e,t){return r.isEmptyVal(e)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},message:"{0} is not a proper email address"};ko.validation.rules.date={validator:function(e,t){return r.isEmptyVal(e)||t&&!/Invalid|NaN/.test(new Date(e))},message:"Please enter a proper date"};ko.validation.rules.dateISO={validator:function(e,t){return r.isEmptyVal(e)||t&&/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(e)},message:"Please enter a proper date"};ko.validation.rules.number={validator:function(e,t){return r.isEmptyVal(e)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(e)},message:"Please enter a number"};ko.validation.rules.digit={validator:function(e,t){return r.isEmptyVal(e)||t&&/^\d+$/.test(e)},message:"Please enter a digit"};ko.validation.rules.phoneUS={validator:function(e,t){if(typeof e!="string")return!1;if(r.isEmptyVal(e))return!0;e=e.replace(/\s+/g,"");return t&&e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},message:"Please specify a valid phone number"};ko.validation.rules.equal={validator:function(e,t){var n=t;return e===r.getValue(n)},message:"Values must equal"};ko.validation.rules.notEqual={validator:function(e,t){var n=t;return e!==r.getValue(n)},message:"Please choose another value."};ko.validation.rules.unique={validator:function(e,t){var n=r.getValue(t.collection),i=r.getValue(t.externalValue),s=0;if(!e||!n)return!0;ko.utils.arrayFilter(ko.utils.unwrapObservable(n),function(n){e===(t.valueAccessor?t.valueAccessor(n):n)&&s++});return s<(i!==undefined&&e!==i?1:2)},message:"Please make sure the value is unique."};(function(){ko.validation.registerExtenders()})();(function(){var e=ko.bindingHandlers.value.init;ko.bindingHandlers.value.init=function(t,i,s,o,u){e(t,i,s);var a=r.getConfigOptions(t);a.parseInputAttributes&&n(function(){ko.validation.parseInputValidationAttributes(t,i)});if(a.insertMessages&&r.isValidatable(i())){var f=ko.validation.insertValidationMessage(t);a.messageTemplate?ko.renderTemplate(a.messageTemplate,{field:i()},null,f,"replaceNode"):ko.applyBindingsToNode(f,{validationMessage:i()})}a.decorateElement&&r.isValidatable(i())&&ko.applyBindingsToNode(t,{validationElement:i()})}})();ko.bindingHandlers.validationMessage={update:function(e,t){var n=t(),i=r.getConfigOptions(e),s=ko.utils.unwrapObservable(n),o=null,u=!1,a=!1;n.extend({validatable:!0});u=n.isModified();a=n.isValid();var f=function(){return!i.messagesOnModified||u?a?null:n.error:null},l=function(){return u?!a:!1};ko.bindingHandlers.text.update(e,f);ko.bindingHandlers.visible.update(e,l)}};ko.bindingHandlers.validationElement={update:function(e,t){var n=t(),i=r.getConfigOptions(e),s=ko.utils.unwrapObservable(n),o=null,u=!1,a=!1;n.extend({validatable:!0});u=n.isModified();a=n.isValid();var f=function(){var e={},t=u?!a:!1;i.decorateElement||(t=!1);e[i.errorElementClass]=t;return e};ko.bindingHandlers.css.update(e,f)}};ko.bindingHandlers.validationOptions=function(){return{init:function(t,n,i,s,o){var u=ko.utils.unwrapObservable(n());if(u){var a=ko.utils.extend({},e);ko.utils.extend(a,u);r.setDomData(t,a)}}}}();ko.extenders.validation=function(e,t){ko.utils.arrayForEach(r.isArray(t)?t:[t],function(t){ko.validation.addAnonymousRule(e,t)});return e};ko.extenders.validatable=function(e,t){if(t&&!r.isValidatable(e)){e.error=null;e.rules=ko.observableArray();e.isValidating=ko.observable(!1);e.__valid__=ko.observable(!0);e.isModified=ko.observable(!1);e.clear=function(){e.observableValid(!0);e.isModified(!1)};var n=ko.computed(function(){var t=e(),n=e.rules();ko.validation.validateObservable(e);return!0});e.isValid=ko.computed(function(){return e.__valid__()});e.forceError=ko.observable(!1);var i=e.subscribe(function(){e()!==undefined&&e.isModified(!0)});e.checkValid=function(){if(e.forceError()){e.observableError("force error");e.observableValid(!1)}else if(e.isModified()){e.observableError(e.error);e.observableValid(e.__valid__())}};e.observableValid=ko.observable(!0);e.observableError=ko.observable(!1);e.__valid__.subscribe(function(){e.checkValid()});e.isModified.subscribe(function(){e.checkValid()});e.forceError.subscribe(function(){e.checkValid()});e.validate=function(){var t=ko.validation.validateObservable(e);e.isModified(!0);return t};e._disposeValidation=function(){e.isValid.dispose();e.rules.removeAll();e.isModified._subscriptions.change=[];e.isValidating._subscriptions.change=[];e.__valid__._subscriptions.change=[];i.dispose();n.dispose();delete e.rules;delete e.error;delete e.isValid;delete e.isValidating;delete e.__valid__;delete e.isModified}}else t===!1&&r.isValidatable(e)&&e._disposeValidation&&e._disposeValidation();return e};ko.validation.validateObservable=function(e){var t=0,n,r,o=e.rules(),u=o.length;for(;t<u;t++){r=o[t];n=ko.validation.rules[r.rule];if(n.async||r.async)s(e,n,r);else if(!i(e,n,r))return!1}e.error=null;e.__valid__(!0);return!0};ko.validatedObservable=function(e){if(!ko.validation.utils.isObject(e))return ko.observable(e).extend({validatable:!0});var t=ko.observable(e);t.errors=ko.validation.group(e);t.isValid=ko.computed(function(){return t.errors().length===0});return t};ko.validation.localize=function(e){var t,n;for(n in e)ko.validation.rules.hasOwnProperty(n)&&(ko.validation.rules[n].message=e[n])};ko.applyBindingsWithValidation=function(e,t,n){var r=arguments.length,i,s;if(r>2){i=t;s=n}else r<2?i=document.body:arguments[1].nodeType?i=t:s=arguments[1];ko.validation.init();s&&ko.validation.utils.setDomData(i,s);ko.applyBindings(e,t)};var o=ko.applyBindings;ko.applyBindings=function(e,t){ko.validation.init();o(e,t)}})();